<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Infinite Canvas: Math, Text & Graphs</title>
    
    <!-- Tailwind CSS -->
    <script src="lib/tailwind.min.js"></script>
    
    <!-- 1. MathLive (Editing Math) -->
    <script defer src="lib/mathlive.min.js"></script>
    
    <!-- 2. Marked.js (Markdown) -->
    <script src="lib/marked.min.js"></script>
    
    <!-- 3. KaTeX (Rendering Math in Markdown) -->
    <link rel="stylesheet" href="lib/katex.min.css">
    <script defer src="lib/katex.min.js"></script>
    
    <!-- 4. Function Plot + D3 (Graphing) -->
    <script src="lib/d3.min.js"></script>
    <script src="lib/function-plot.js"></script>

    <!-- Custom Styles -->
    <link rel="stylesheet" href="styles.css">
</head>
<body class="h-screen w-screen overflow-hidden text-slate-800 flex flex-col font-sans">

    <!-- TOP BAR -->
    <header class="h-14 bg-white border-b border-slate-200 flex items-center justify-between px-4 shadow-sm z-20">
        <div class="flex items-center gap-4">
            <h1 class="font-bold text-xl text-slate-700 hidden md:block">Math<span class="text-blue-600">Canvas</span></h1>
            
            <!-- Mode Selector -->
            <div class="flex bg-slate-100 p-1 rounded-lg border border-slate-200">
                <button onclick="app.setMode('math')" id="btn-mode-math" class="px-3 py-1.5 rounded-md text-sm font-medium transition bg-white shadow-sm text-blue-600 ring-1 ring-black/5">
                    âˆ‘ Math
                </button>
                <button onclick="app.setMode('text')" id="btn-mode-text" class="px-3 py-1.5 rounded-md text-sm font-medium transition text-slate-600 hover:bg-white/60">
                    Aa Text
                </button>
                <button onclick="app.setMode('graph')" id="btn-mode-graph" class="px-3 py-1.5 rounded-md text-sm font-medium transition text-slate-600 hover:bg-white/60">
                    ğŸ“ˆ Graph
                </button>
                <button onclick="document.getElementById('img-upload').click()" class="px-3 py-1.5 rounded-md text-sm font-medium transition text-slate-600 hover:bg-slate-50 ml-2">
                    ğŸ–¼ï¸ Image
                </button>
                <input type="file" id="img-upload" accept="image/*" class="hidden" onchange="app.addImage(this)">
            </div>

            <div class="h-5 w-px bg-slate-300"></div>

            <!-- Actions -->
            <div class="flex gap-2">
                <button onclick="app.undo()" class="px-2 py-1 hover:bg-slate-100 rounded text-sm text-slate-600 transition">â†© Undo</button>
                <button onclick="app.saveJSON()" class="px-2 py-1 hover:bg-slate-100 rounded text-sm text-slate-600 transition">ğŸ›« Export</button>
                <label class="px-2 py-1 hover:bg-slate-100 rounded text-sm text-slate-600 transition cursor-pointer">
                    ğŸ›¬ Import <input type="file" accept=".json" class="hidden" onchange="app.loadJSON(this)">
                </label>
                <button onclick="app.manualSave()" class="px-2 py-1 hover:bg-slate-100 rounded text-sm text-slate-600 transition">ğŸ’¾ Save</button>
            </div>
        </div>
        
        <div class="text-xs text-slate-400 hidden lg:flex gap-4">
            <span>Double-click to add node.</span>
            <span><b>$..$</b> for inline math, <b>$..$</b> for blocks.</span>
            <button onclick="app.clearCanvas()" class="text-red-400 hover:text-red-600 font-semibold hover:underline">Clear Canvas</button>
        </div>
    </header>

    <!-- CANVAS -->
    <main id="canvas-container" class="flex-1 relative overflow-hidden w-full h-full">
        <div id="canvas-world" class="absolute top-0 left-0 w-full h-full origin-top-left will-change-transform"></div>
        
        <!-- Zoom Controls -->
        <div class="absolute bottom-5 right-5 flex flex-col bg-white shadow-lg rounded-lg border border-slate-200 z-30 overflow-hidden">
            <button onclick="app.zoomIn()" class="p-3 hover:bg-slate-50 active:bg-slate-100 border-b border-slate-100 text-slate-600">+</button>
            <button id="zoom-indicator" onclick="app.resetView()" class="p-2 hover:bg-slate-50 text-xs font-bold text-slate-500">100%</button>
            <button onclick="app.zoomOut()" class="p-3 hover:bg-slate-50 active:bg-slate-100 border-t border-slate-100 text-slate-600">-</button>
        </div>
    </main>

    <!-- Custom JavaScript -->
    <script src="app.js"></script>
</body>
</html>
